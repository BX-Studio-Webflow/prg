const I="https://prg-one.vercel.app";document.addEventListener("DOMContentLoaded",async()=>{const C=document.querySelector("[dev-target=job-search]"),y=document.querySelectorAll("[dev-target-filters]"),m=document.querySelector("[dev-target=job-item-template]"),h=document.querySelector("[dev-target=job-loader]"),q=document.querySelector("[dev-target=jobs-reset]"),L=document.querySelector("[dev-target=jobs-wrapper]"),w=document.querySelector("[dev-target=job-list]");let u="",j="",g="",l=null;if(!C||!y||!m||!h||!L||!q||!w)return console.error("Missing elements");try{const e=await x();console.log({jobs:e}),l=e,v({jobs:e,jobList:w,jobLoader:h,jobItemTemplate:m,jobsWrapper:L}),J({jobSearchInput:C,jobItemTemplate:m,jobList:w,jobLoader:h,jobsWrapper:L}),M({jobFilterWrappers:y,jobItemTemplate:m,jobList:w,jobLoader:h,jobsWrapper:L}),q.addEventListener("click",()=>{k({jobList:w,jobLoader:h,jobItemTemplate:m,jobsWrapper:L,jobSearchInput:C,jobFilterWrappers:y})}),document.addEventListener("click",t=>{t.target instanceof Element&&!t.target.closest("[dev-target-filters]")&&y.forEach(s=>{const r=s.querySelector("[dev-target=dd-wrapper]");r&&r.setAttribute("dev-hide","true")})})}catch(e){console.error("Something went wrong",e)}function k({jobList:e,jobLoader:t,jobItemTemplate:s,jobsWrapper:r,jobSearchInput:n,jobFilterWrappers:a}){if(u="",j="",g="",n.value="",a.forEach(o=>{const c=o.querySelector("[dev-target=dd-input]");if(!c)return console.error("Missing filter dropdown elements");c.textContent="Select one..."}),l){const o=S({category:j,jobs:l,search:g,state:u});v({jobs:o,jobList:e,jobLoader:t,jobItemTemplate:s,jobsWrapper:r})}}function J({jobSearchInput:e,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n}){e.addEventListener("input",a=>{if(g=a.target.value,l){const c=S({category:j,jobs:l,search:g,state:u});v({jobs:c,jobList:s,jobLoader:r,jobItemTemplate:t,jobsWrapper:n})}})}function S({category:e,jobs:t,search:s,state:r}){return{...t,data:t.data.filter(n=>{var d,i,f,p;const a=s===""||n.title.toLowerCase().includes(s.toLowerCase())||((d=n.address.state)==null?void 0:d.toLowerCase().includes(s.toLowerCase()))||((i=n.address.city)==null?void 0:i.toLowerCase().includes(s.toLowerCase()))||((f=n.customText2)==null?void 0:f.toLowerCase().includes(s.toLowerCase())),o=r===""||((p=n.address.state)==null?void 0:p.toLowerCase())===r.toLowerCase(),c=e===""||n.publishedCategory.name.toLowerCase()===e.toLowerCase();return a&&o&&c})}}function M({jobFilterWrappers:e,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n}){e.forEach(async a=>{const o=a.getAttribute("dev-target-filters"),c=a.querySelector("[dev-target=dd-input]"),d=a.querySelector("[dev-target=dd-wrapper]");if(!d||!c)return console.error("Missing filter dropdown elements");if(!o)return console.error("Missing filter type");if(o==="state"){const i=await F();A({filterDropdownInput:c,filterDropdownWrapper:d,filterList:i,filterType:o,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n})}else if(o==="category"){const i=await W();A({filterDropdownInput:c,filterDropdownWrapper:d,filterList:i,filterType:o,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n})}})}function A({filterDropdownInput:e,filterDropdownWrapper:t,filterList:s,filterType:r,jobList:n,jobLoader:a,jobItemTemplate:o,jobsWrapper:c}){const d=document.querySelectorAll("[dev-target=dd-wrapper]"),i=t.querySelector("[dev-target=dd-container]"),f=t.querySelector("[dev-target=dd-item-template]");if(!i||!f)return console.error("Missing filter dropdown elements");i.innerHTML="",console.log({filterDropdownInput:e}),e.addEventListener("click",()=>{console.log("click"),d.forEach(b=>{b!==t&&b.setAttribute("dev-hide","true")}),t.getAttribute("dev-hide")==="true"?t.setAttribute("dev-hide","false"):t.setAttribute("dev-hide","true")});const p=f.cloneNode(!0);p.textContent="Select one...",p.addEventListener("click",()=>{if(e.textContent="Select one...",r==="state"?u="":r==="category"&&(j=""),t.setAttribute("dev-hide","true"),l){const b=S({category:j,jobs:l,search:g,state:u});v({jobs:b,jobList:n,jobLoader:a,jobItemTemplate:o,jobsWrapper:c})}}),i.appendChild(p),s.filter(Boolean).forEach(b=>{const E=f.cloneNode(!0);E.textContent=b,E.addEventListener("click",()=>{if(e.textContent=b,r==="state"?u=b:r==="category"&&(j=b),t.setAttribute("dev-hide","true"),l){const $=S({category:j,jobs:l,search:g,state:u});v({jobs:$,jobList:n,jobLoader:a,jobItemTemplate:o,jobsWrapper:c})}}),i.appendChild(E)})}function v({jobs:e,jobList:t,jobLoader:s,jobItemTemplate:r,jobsWrapper:n}){t.innerHTML="",e.data.forEach(a=>{const o=r.cloneNode(!0),c=o.querySelector("[dev-target=item-link]"),d=o.querySelector("[dev-target=item-title]"),i=o.querySelector("[dev-target=location]");if(!c||!d||!i)return console.error("Missing job item elements");c.href=`/internal-jobs-final?id=${a.id}`,d.textContent=a.title,i.textContent=`${a.address.city??""}${a.address.state?" / "+a.address.state:""}`,t.appendChild(o)}),T({element:s,toggle:"hide"}),T({element:n,toggle:"show"})}function T({element:e,toggle:t}){t==="show"?e.setAttribute("dev-hide","false"):e.setAttribute("dev-hide","true")}async function x(){try{const e=await fetch(`${I}/api/jobs`);if(!e.ok)throw new Error("Failed to fetch jobs");return await e.json()}catch(e){throw console.error("Error fetching jobs:",e),e}}async function F(){try{const e=await fetch(`${I}/api/states`);if(!e.ok)throw new Error("Failed to fetch job states");return await e.json()}catch(e){throw console.error("Error fetching job states:",e),e}}async function W(){try{const e=await fetch(`${I}/api/categories`);if(!e.ok)throw new Error("Failed to fetch job categories");return await e.json()}catch(e){throw console.error("Error fetching job categories:",e),e}}});
//# sourceMappingURL=jobs.js.map

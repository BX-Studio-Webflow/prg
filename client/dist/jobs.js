import{e as B}from"./chunks/index.BNVWmogu.js";const x="https://prg-one.vercel.app";document.addEventListener("DOMContentLoaded",async()=>{const C=document.querySelector("[dev-target=job-search]"),w=document.querySelectorAll("[dev-target-filters]"),f=document.querySelector("[dev-target=job-item-template]"),h=document.querySelector("[dev-target=job-loader]"),q=document.querySelector("[dev-target=jobs-reset]"),L=document.querySelector("[dev-target=jobs-wrapper]"),y=document.querySelector("[dev-target=job-list]"),k=Object.entries(B).map(([e,t])=>({id:e,name:t}));let u="",j="",m="",b=null;if(!C||!w||!f||!h||!L||!q||!y)return console.error("Missing elements");try{const e=await W();console.log({jobs:e}),b=e,v({jobs:e,jobList:y,jobLoader:h,jobItemTemplate:f,jobsWrapper:L}),J({jobSearchInput:C,jobItemTemplate:f,jobList:y,jobLoader:h,jobsWrapper:L}),F({jobFilterWrappers:w,jobItemTemplate:f,jobList:y,jobLoader:h,jobsWrapper:L}),q.addEventListener("click",()=>{M({jobList:y,jobLoader:h,jobItemTemplate:f,jobsWrapper:L,jobSearchInput:C,jobFilterWrappers:w})}),document.addEventListener("click",t=>{t.target instanceof Element&&!t.target.closest("[dev-target-filters]")&&w.forEach(s=>{const r=s.querySelector("[dev-target=dd-wrapper]");r&&r.setAttribute("dev-hide","true")})})}catch(e){console.error("Something went wrong",e)}function M({jobList:e,jobLoader:t,jobItemTemplate:s,jobsWrapper:r,jobSearchInput:n,jobFilterWrappers:a}){if(u="",j="",m="",n.value="",a.forEach(o=>{const c=o.querySelector("[dev-target=dd-input]");if(!c)return console.error("Missing filter dropdown elements");c.textContent="Select one..."}),b){const o=S({category:j,jobs:b,search:m,state:u});v({jobs:o,jobList:e,jobLoader:t,jobItemTemplate:s,jobsWrapper:r})}}function J({jobSearchInput:e,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n}){e.addEventListener("input",a=>{if(m=a.target.value,b){const c=S({category:j,jobs:b,search:m,state:u});v({jobs:c,jobList:s,jobLoader:r,jobItemTemplate:t,jobsWrapper:n})}})}function S({category:e,jobs:t,search:s,state:r}){return{...t,data:t.data.filter(n=>{var d,i,p,g;const a=s===""||n.title.toLowerCase().includes(s.toLowerCase())||((d=n.address.state)==null?void 0:d.toLowerCase().includes(s.toLowerCase()))||((i=n.address.city)==null?void 0:i.toLowerCase().includes(s.toLowerCase()))||((p=n.customText2)==null?void 0:p.toLowerCase().includes(s.toLowerCase())),o=r===""||((g=n.address.state)==null?void 0:g.toLowerCase())===r.toLowerCase(),c=e===""||n.externalCategoryID===parseInt(e);return a&&o&&c})}}function F({jobFilterWrappers:e,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n}){e.forEach(async a=>{const o=a.getAttribute("dev-target-filters"),c=a.querySelector("[dev-target=dd-input]"),d=a.querySelector("[dev-target=dd-wrapper]");if(!d||!c)return console.error("Missing filter dropdown elements");if(!o)return console.error("Missing filter type");if(o==="state"){const i=await $();A({filterDropdownInput:c,filterDropdownWrapper:d,filterList:i,filterType:o,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n})}else o==="category"&&A({filterDropdownInput:c,filterDropdownWrapper:d,filterList:k,filterType:o,jobItemTemplate:t,jobList:s,jobLoader:r,jobsWrapper:n})})}function A({filterDropdownInput:e,filterDropdownWrapper:t,filterList:s,filterType:r,jobList:n,jobLoader:a,jobItemTemplate:o,jobsWrapper:c}){const d=document.querySelectorAll("[dev-target=dd-wrapper]"),i=t.querySelector("[dev-target=dd-container]"),p=t.querySelector("[dev-target=dd-item-template]");if(!i||!p)return console.error("Missing filter dropdown elements");i.innerHTML="",console.log({filterDropdownInput:e}),e.addEventListener("click",()=>{console.log("click"),d.forEach(l=>{l!==t&&l.setAttribute("dev-hide","true")}),t.getAttribute("dev-hide")==="true"?t.setAttribute("dev-hide","false"):t.setAttribute("dev-hide","true")});const g=p.cloneNode(!0);g.textContent="Select one...",g.addEventListener("click",()=>{if(e.textContent="Select one...",r==="state"?u="":r==="category"&&(j=""),t.setAttribute("dev-hide","true"),b){const l=S({category:j,jobs:b,search:m,state:u});v({jobs:l,jobList:n,jobLoader:a,jobItemTemplate:o,jobsWrapper:c})}}),i.appendChild(g),s.filter(Boolean).forEach(l=>{const I=p.cloneNode(!0),E=typeof l=="string"?l:l.name,H=typeof l=="string"?"":l.id;I.textContent=E,I.addEventListener("click",()=>{if(e.textContent=E,r==="state"?u=E:r==="category"&&(j=H),t.setAttribute("dev-hide","true"),b){const N=S({category:j,jobs:b,search:m,state:u});v({jobs:N,jobList:n,jobLoader:a,jobItemTemplate:o,jobsWrapper:c})}}),i.appendChild(I)})}function v({jobs:e,jobList:t,jobLoader:s,jobItemTemplate:r,jobsWrapper:n}){t.innerHTML="",e.data.forEach(a=>{const o=r.cloneNode(!0),c=o.querySelector("[dev-target=item-link]"),d=o.querySelector("[dev-target=item-title]"),i=o.querySelector("[dev-target=location]");if(!c||!d||!i)return console.error("Missing job item elements");c.href=`/internal-jobs-final?id=${a.id}`,d.textContent=a.title,i.textContent=`${a.address.city??""}${a.address.state?" / "+a.address.state:""}`,t.appendChild(o)}),T({element:s,toggle:"hide"}),T({element:n,toggle:"show"})}function T({element:e,toggle:t}){t==="show"?e.setAttribute("dev-hide","false"):e.setAttribute("dev-hide","true")}async function W(){try{const e=await fetch(`${x}/api/jobs`);if(!e.ok)throw new Error("Failed to fetch jobs");return await e.json()}catch(e){throw console.error("Error fetching jobs:",e),e}}async function $(){try{const e=await fetch(`${x}/api/states`);if(!e.ok)throw new Error("Failed to fetch job states");return await e.json()}catch(e){throw console.error("Error fetching job states:",e),e}}});
//# sourceMappingURL=jobs.js.map

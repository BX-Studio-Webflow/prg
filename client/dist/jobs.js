const C="https://prg-one.vercel.app";document.addEventListener("DOMContentLoaded",async()=>{const w=document.querySelector("[dev-target=job-search]"),v=document.querySelectorAll("[dev-target-filters]"),f=document.querySelector("[dev-target=job-item-template]"),p=document.querySelector("[dev-target=job-loader]"),q=document.querySelector("[dev-target=jobs-reset]"),h=document.querySelector("[dev-target=jobs-wrapper]"),m=document.querySelector("[dev-target=job-list]");let u="",j="",g="",d=null;if(!w||!v||!f||!p||!h||!q||!m)return console.error("Missing elements");try{const e=await F();console.log({jobs:e}),d=e,L({jobs:e,jobList:m,jobLoader:p,jobItemTemplate:f,jobsWrapper:h}),J({jobSearchInput:w,jobItemTemplate:f,jobList:m,jobLoader:p,jobsWrapper:h}),M({jobFilterWrappers:v,jobItemTemplate:f,jobList:m,jobLoader:p,jobsWrapper:h}),q.addEventListener("click",()=>{k({jobList:m,jobLoader:p,jobItemTemplate:f,jobsWrapper:h,jobSearchInput:w,jobFilterWrappers:v})}),document.addEventListener("click",t=>{t.target instanceof Element&&!t.target.closest("[dev-target-filters]")&&v.forEach(a=>{const r=a.querySelector("[dev-target=dd-wrapper]");r&&r.setAttribute("dev-hide","true")})})}catch(e){console.error("Something went wrong",e)}function k({jobList:e,jobLoader:t,jobItemTemplate:a,jobsWrapper:r,jobSearchInput:c,jobFilterWrappers:s}){if(u="",j="",g="",c.value="",s.forEach(o=>{const n=o.querySelector("[dev-target=dd-input]");if(!n)return console.error("Missing filter dropdown elements");n.textContent="Select one..."}),d){const o=y({category:j,jobs:d,search:g,state:u});L({jobs:o,jobList:e,jobLoader:t,jobItemTemplate:a,jobsWrapper:r})}}function J({jobSearchInput:e,jobItemTemplate:t,jobList:a,jobLoader:r,jobsWrapper:c}){e.addEventListener("input",s=>{if(g=s.target.value,d){const n=y({category:j,jobs:d,search:g,state:u});L({jobs:n,jobList:a,jobLoader:r,jobItemTemplate:t,jobsWrapper:c})}})}function y({category:e,jobs:t,search:a,state:r}){return{...t,data:t.data.filter(c=>{var i;const s=a===""||c.title.toLowerCase().includes(a.toLowerCase()),o=r===""||((i=c.address.state)==null?void 0:i.toLowerCase())===r.toLowerCase(),n=e===""||c.publishedCategory.name.toLowerCase()===e.toLowerCase();return s&&o&&n})}}function M({jobFilterWrappers:e,jobItemTemplate:t,jobList:a,jobLoader:r,jobsWrapper:c}){e.forEach(async s=>{const o=s.getAttribute("dev-target-filters"),n=s.querySelector("[dev-target=dd-input]"),i=s.querySelector("[dev-target=dd-wrapper]");if(!i||!n)return console.error("Missing filter dropdown elements");if(!o)return console.error("Missing filter type");if(o==="state"){const l=await x();A({filterDropdownInput:n,filterDropdownWrapper:i,filterList:l,filterType:o,jobItemTemplate:t,jobList:a,jobLoader:r,jobsWrapper:c})}else if(o==="category"){const l=await W();A({filterDropdownInput:n,filterDropdownWrapper:i,filterList:l,filterType:o,jobItemTemplate:t,jobList:a,jobLoader:r,jobsWrapper:c})}})}function A({filterDropdownInput:e,filterDropdownWrapper:t,filterList:a,filterType:r,jobList:c,jobLoader:s,jobItemTemplate:o,jobsWrapper:n}){const i=document.querySelectorAll("[dev-target=dd-wrapper]"),l=t.querySelector("[dev-target=dd-container]"),S=t.querySelector("[dev-target=dd-item-template]");if(!l||!S)return console.error("Missing filter dropdown elements");l.innerHTML="",console.log({filterDropdownInput:e}),e.addEventListener("click",()=>{console.log("click"),i.forEach(b=>{b!==t&&b.setAttribute("dev-hide","true")}),t.getAttribute("dev-hide")==="true"?t.setAttribute("dev-hide","false"):t.setAttribute("dev-hide","true")});const E=S.cloneNode(!0);E.textContent="Select one...",E.addEventListener("click",()=>{if(e.textContent="Select one...",r==="state"?u="":r==="category"&&(j=""),t.setAttribute("dev-hide","true"),d){const b=y({category:j,jobs:d,search:g,state:u});L({jobs:b,jobList:c,jobLoader:s,jobItemTemplate:o,jobsWrapper:n})}}),l.appendChild(E),a.filter(Boolean).forEach(b=>{const I=S.cloneNode(!0);I.textContent=b,I.addEventListener("click",()=>{if(e.textContent=b,r==="state"?u=b:r==="category"&&(j=b),t.setAttribute("dev-hide","true"),d){const $=y({category:j,jobs:d,search:g,state:u});L({jobs:$,jobList:c,jobLoader:s,jobItemTemplate:o,jobsWrapper:n})}}),l.appendChild(I)})}function L({jobs:e,jobList:t,jobLoader:a,jobItemTemplate:r,jobsWrapper:c}){t.innerHTML="",e.data.forEach(s=>{const o=r.cloneNode(!0),n=o.querySelector("[dev-target=item-link]"),i=o.querySelector("[dev-target=item-title]"),l=o.querySelector("[dev-target=location]");if(!n||!i||!l)return console.error("Missing job item elements");n.href=`/internal-jobs-final?id=${s.id}`,i.textContent=s.title,l.textContent=`${s.address.city}${s.address.state?"/"+s.address.state:""}`,t.appendChild(o)}),T({element:a,toggle:"hide"}),T({element:c,toggle:"show"})}function T({element:e,toggle:t}){t==="show"?e.setAttribute("dev-hide","false"):e.setAttribute("dev-hide","true")}async function F(){try{const e=await fetch(`${C}/api/jobs`);if(!e.ok)throw new Error("Failed to fetch jobs");return await e.json()}catch(e){throw console.error("Error fetching jobs:",e),e}}async function x(){try{const e=await fetch(`${C}/api/states`);if(!e.ok)throw new Error("Failed to fetch job states");return await e.json()}catch(e){throw console.error("Error fetching job states:",e),e}}async function W(){try{const e=await fetch(`${C}/api/categories`);if(!e.ok)throw new Error("Failed to fetch job categories");return await e.json()}catch(e){throw console.error("Error fetching job categories:",e),e}}});
//# sourceMappingURL=jobs.js.map
